<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Solar Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  font-family: Arial;
  background:#f2f2f2;
  margin:20px;
}
.grid{
  display:grid;
  grid-template-columns: repeat(6, 1fr);
  gap:10px;
}
.box{
  background:#f6c9a7;
  padding:12px;
  text-align:center;
  border-radius:6px;
}
.green{
  background:#b7d99c;
}
canvas{
  background:#fff;
  padding:10px;
  border-radius:8px;
}
</style>
</head>

<body>

<h2 style="text-align:center;">Shree Hari Fertilizers</h2>

<div class="grid">
  <div class="box">Day Gen<br><b id="dayGen">--</b></div>
  <div class="box">Yesterday Gen<br><b id="yGen">--</b></div>
  <div class="box">Month Gen<br><b id="monthGen">--</b></div>
  <div class="box">Year Gen<br><b id="yearGen">--</b></div>
  <div class="box">Day PR<br><b id="dayPR">--</b></div>
  <div class="box">Month PR<br><b id="monthPR">--</b></div>
</div>

<br><br>

<canvas id="dailyChart"></canvas>
<br><br>
<canvas id="monthlyChart"></canvas>

<script>
// ðŸ‘‡ YOUR SHEET (ID + GID)
const sheetURL =
"https://docs.google.com/spreadsheets/d/1Y3cr91xEEQj86B9hXMYdpp6UU1a33-vlrFcWKkLRujg/export?format=csv&gid=861206775";

fetch(sheetURL)
.then(res => res.text())
.then(csv => {

  const rows = csv.split("\n").slice(1);
  let data = [];

  rows.forEach(r=>{
    let c = r.split(",");
    if(c.length < 6) return;

    data.push({
      plant: c[0],
      dc: parseFloat(c[1]),
      ac: parseFloat(c[2]),
      date: new Date(c[3]),
      gen: parseFloat(c[4]),
      pr: parseFloat(c[5])
    });
  });

  const today = new Date();
  const yesterday = new Date();
  yesterday.setDate(today.getDate()-1);

  let dayGen=0, yGen=0, dayPR=0;
  let monthGen=0, yearGen=0, prSum=0, prCount=0;

  let dailyLabels=[], dailyData=[];

  data.forEach(d=>{
    if(d.date.toDateString() === today.toDateString()){
      dayGen = d.gen;
      dayPR = d.pr;
    }
    if(d.date.toDateString() === yesterday.toDateString()){
      yGen = d.gen;
    }

    if(d.date.getMonth()===today.getMonth() &&
       d.date.getFullYear()===today.getFullYear()){
      monthGen += d.gen;
      prSum += d.pr;
      prCount++;

      dailyLabels.push(d.date.getDate());
      dailyData.push(d.gen);
    }

    if(d.date.getFullYear()===today.getFullYear()){
      yearGen += d.gen;
    }
  });

  document.getElementById("dayGen").innerText = dayGen.toFixed(2)+" MWh";
  document.getElementById("yGen").innerText = yGen.toFixed(2)+" MWh";
  document.getElementById("monthGen").innerText = monthGen.toFixed(2)+" MWh";
  document.getElementById("yearGen").innerText = yearGen.toFixed(2)+" MWh";
  document.getElementById("dayPR").innerText = dayPR.toFixed(2)+" %";
  document.getElementById("monthPR").innerText = (prSum/prCount).toFixed(2)+" %";

  new Chart(dailyChart,{
    type:'bar',
    data:{
      labels:dailyLabels,
      datasets:[{
        label:'Daily Generation (MWh)',
        data:dailyData
      }]
    }
  });

  let monthMap={};
  data.forEach(d=>{
    let key = d.date.getFullYear()+"-"+(d.date.getMonth()+1);
    monthMap[key]=(monthMap[key]||0)+d.gen;
  });

  new Chart(monthlyChart,{
    type:'bar',
    data:{
      labels:Object.keys(monthMap),
      datasets:[{
        label:'Monthly Generation (MWh)',
        data:Object.values(monthMap)
      }]
    }
  });

})
.catch(err=>{
  alert("Data load zala nahi. Sheet publish kela ka check kar.");
});
</script>

</body>
</html>
