<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Solar Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2;padding:20px;}
.grid{display:grid;grid-template-columns:repeat(6,1fr);gap:10px;}
  .box{
    padding:16px;
    text-align:center;
    border-radius:14px;
    color:#fff;
    font-weight:600;
    box-shadow:0 6px 16px rgba(0,0,0,0.15);
    transition:transform 0.25s, box-shadow 0.25s;
  }
        .cards-row{
        display:flex;
        gap:14px;
        width:100%;
      }
      
      /* Make all cards equal width */
      .cards-row .box{
        flex:1;
        min-width:0;   /* prevents wrapping */
      }

  .box:hover{
    transform:translateY(-6px);
    box-shadow:0 10px 22px rgba(0,0,0,0.25);
  }
  
  /* Individual colors */
  .box:nth-child(1){ background:linear-gradient(135deg,#ff9a9e,#fad0c4);}
  .box:nth-child(2){ background:linear-gradient(135deg,#a18cd1,#fbc2eb);}
  .box:nth-child(3){ background:linear-gradient(135deg,#f6d365,#fda085);}
  .box:nth-child(4){ background:linear-gradient(135deg,#84fab0,#8fd3f4);}
  .box:nth-child(5){ background:linear-gradient(135deg,#ffecd2,#fcb69f); color:#333;}
  .box:nth-child(6){ background:linear-gradient(135deg,#a1c4fd,#c2e9fb);}

canvas{background:#fff;padding:10px;border-radius:8px;}
.main-layout{
  display:flex;
  gap:20px;
}

/* LEFT */
.left-panel{
  width:55%;
}

/* RIGHT */
.right-panel{
  width:45%;
  display:flex;
  flex-direction:column;
  gap:20px;
}

/* GRAPH SIZE CONTROL HERE ðŸ‘‡ */
.chart-box{
  width:100%;
  height:230px;
  background:linear-gradient(135deg,#ffffff,#f3f6fb);
  padding:14px;
  border-radius:16px;
  box-shadow:0 8px 18px rgba(0,0,0,0.12);
}


/* Canvas fills box */
.chart-box canvas{
  width:100% !important;
  height:100% !important;
}

</style>
</head>

<body>

<h2 style="text-align:center;">Shree Hari Fertilizers</h2>

            <!-- ===== ROW 1 : CARDS ===== -->
            <div class="cards-row">
              <div class="box">Day Gen<br><b id="dayGen">--</b></div>
              <div class="box">Yesterday Gen<br><b id="yGen">--</b></div>
              <div class="box">Month Gen<br><b id="monthGen">--</b></div>
              <div class="box">Year Gen<br><b id="yearGen">--</b></div>
              <div class="box">Day PR<br><b id="dayPR">--</b></div>
              <div class="box">Month PR<br><b id="monthPR">--</b></div>
            </div>
            
            <br>
            
            <!-- ===== ROW 2 : GRAPHS ===== -->
            <div class="graphs-row">
              <div class="chart-box">
                <canvas id="dailyChart"></canvas>
              </div>
            
              <div class="chart-box">
                <canvas id="monthlyChart"></canvas>
              </div>
            </div>



<br><br>
<canvas id="dailyChart"></canvas>
<br><br>
<canvas id="monthlyChart"></canvas>

<script>
const sheetURL =
"https://docs.google.com/spreadsheets/d/1Y3cr91xEEQj86B9hXMYdpp6UU1a33-vlrFcWKkLRujg/export?format=csv&gid=861206775";

function parseDDMMYY(dateStr){
  if(!dateStr) return null;
  let p = dateStr.split("-");
  if(p.length !== 3) return null;

  let dd = parseInt(p[0],10);
  let mm = parseInt(p[1],10) - 1;
  let yy = parseInt(p[2],10);
  if(yy < 100) yy = 2000 + yy;

  return new Date(yy, mm, dd);
}

function key(d){
  return d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();
}

function parseCSV(text){
  const lines = text.trim().split("\n");
  const headers = lines.shift().split(",").map(h=>h.trim());
  return lines.map(l=>{
    const v = l.split(",");
    let o={};
    headers.forEach((h,i)=>o[h]=v[i]?v[i].trim():"");
    return o;
  });
}

fetch(sheetURL)
.then(r=>r.text())
.then(csv=>{

  const rows = parseCSV(csv);

  const today = new Date();
  const yesterday = new Date();
  yesterday.setDate(today.getDate()-1);

  const todayKey = key(today);
  const yesterdayKey = key(yesterday);

  let dayGen=0, yGen=0, dayPR=0;
  let monthGen=0, yearGen=0, prSum=0, prCount=0;

  let dailyLabels=[], dailyData=[];
  let monthMap={};

  rows.forEach(r=>{
    const d = parseDDMMYY(r["Date"]);
    if(!d) return;

    const gen = parseFloat(r["Day Gen"]) || 0;
    const pr  = parseFloat(r["PR"]) || 0;

    if(key(d) === todayKey){
      dayGen = gen;
      dayPR = pr;
    }

    if(key(d) === yesterdayKey){
      yGen = gen;
    }

    if(d.getMonth()===today.getMonth() &&
       d.getFullYear()===today.getFullYear()){
      monthGen += gen;
      prSum += pr;
      prCount++;
      dailyLabels.push(d.getDate());
      dailyData.push(gen);
    }

    if(d.getFullYear()===today.getFullYear()){
      yearGen += gen;
    }

    let mKey = d.getFullYear()+"-"+(d.getMonth()+1);
    monthMap[mKey]=(monthMap[mKey]||0)+gen;
  });

  document.getElementById("dayGen").innerText = dayGen.toFixed(2)+" MWh";
  document.getElementById("yGen").innerText   = yGen.toFixed(2)+" MWh";
  document.getElementById("monthGen").innerText = monthGen.toFixed(2)+" MWh";
  document.getElementById("yearGen").innerText  = yearGen.toFixed(2)+" MWh";
  document.getElementById("dayPR").innerText = dayPR.toFixed(2)+" %";
  document.getElementById("monthPR").innerText =
    prCount ? (prSum/prCount).toFixed(2)+" %" : "0 %";

new Chart(dailyChart,{
  type:'bar',
  data:{
    labels:dailyLabels,
    datasets:[{
      label:'Daily Generation (MWh)',
      data:dailyData,
      backgroundColor:[
        '#ff9a9e','#fad0c4','#fbc2eb','#a1c4fd',
        '#84fab0','#f6d365','#fda085'
      ]
    }]
  },
  options:{
    responsive:true,
    maintainAspectRatio:false,
    plugins:{
      legend:{labels:{font:{size:11}}}
    }
  }
});


new Chart(monthlyChart,{
  type:'bar',
  data:{
    labels:Object.keys(monthMap),
    datasets:[{
      label:'Monthly Generation (MWh)',
      data:Object.values(monthMap),
      backgroundColor:'#4f46e5'
    }]
  },
  options:{
    responsive:true,
    maintainAspectRatio:false,
    plugins:{
      legend:{labels:{font:{size:11}}}
    }
  }
});


});
</script>
</body>
</html>
