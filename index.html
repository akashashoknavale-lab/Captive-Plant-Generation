<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Solar Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial; background:#f5f5f5; }
.box { padding:15px; background:#f6c9a7; margin:5px; text-align:center; }
.green { background:#b7d99c; }
.grid { display:grid; grid-template-columns: repeat(6, 1fr); gap:10px; }
</style>
</head>

<body>

<h2 style="text-align:center;">Shree Hari Fertilizers</h2>

<div class="grid">
  <div class="box">Day Gen<br><b id="dayGen">--</b></div>
  <div class="box">Yesterday Gen<br><b id="yGen">--</b></div>
  <div class="box">Month Gen<br><b id="monthGen">--</b></div>
  <div class="box">Year Gen<br><b id="yearGen">--</b></div>
  <div class="box">Day PR<br><b id="dayPR">--</b></div>
  <div class="box">Month PR<br><b id="monthPR">--</b></div>
</div>

<br>

<canvas id="dailyChart"></canvas>
<br>
<canvas id="monthChart"></canvas>

<script>
const sheetURL =
const sheetURL =
"https://docs.google.com/spreadsheets/d/1Y3cr91xEEQj86B9hXMYdpp6UU1a33-vlrFcWKkLRujg/pub?output=csv";

fetch(sheetURL)
.then(res => res.text())
.then(csv => {
  const rows = csv.split("\n").slice(1);
  let data = rows.map(r => {
    let c = r.split(",");
    return {
      plant: c[0],
      dc: parseFloat(c[1]),
      ac: parseFloat(c[2]),
      date: new Date(c[3]),
      gen: parseFloat(c[4]),
      pr: parseFloat(c[5])
    };
  });

  const today = new Date().toDateString();
  const thisMonth = new Date().getMonth();
  const thisYear = new Date().getFullYear();

  let dayGen = 0, dayPR = 0;
  let yGen = 0;
  let monthGen = 0, monthPRsum = 0, mCount = 0;
  let yearGen = 0;

  let dailyLabels = [], dailyValues = [];

  data.forEach(d => {
    if (d.date.toDateString() === today) {
      dayGen = d.gen;
      dayPR = d.pr;
    }

    let y = new Date();
    y.setDate(y.getDate()-1);
    if (d.date.toDateString() === y.toDateString()) {
      yGen = d.gen;
    }

    if (d.date.getMonth() === thisMonth && d.date.getFullYear() === thisYear) {
      monthGen += d.gen;
      monthPRsum += d.pr;
      mCount++;

      dailyLabels.push(d.date.getDate());
      dailyValues.push(d.gen);
    }

    if (d.date.getFullYear() === thisYear) {
      yearGen += d.gen;
    }
  });

  document.getElementById("dayGen").innerText = dayGen.toFixed(2)+" MWh";
  document.getElementById("yGen").innerText = yGen.toFixed(2)+" MWh";
  document.getElementById("monthGen").innerText = monthGen.toFixed(2)+" MWh";
  document.getElementById("yearGen").innerText = yearGen.toFixed(2)+" MWh";
  document.getElementById("dayPR").innerText = dayPR.toFixed(2)+" %";
  document.getElementById("monthPR").innerText = (monthPRsum/mCount).toFixed(2)+" %";

  new Chart(dailyChart, {
    type: 'bar',
    data: {
      labels: dailyLabels,
      datasets: [{
        label: 'Daily Generation',
        data: dailyValues
      }]
    }
  });

  let monthMap = {};
  data.forEach(d=>{
    let k = d.date.getFullYear()+"-"+(d.date.getMonth()+1);
    monthMap[k] = (monthMap[k]||0)+d.gen;
  });

  new Chart(monthChart,{
    type:'bar',
    data:{
      labels:Object.keys(monthMap),
      datasets:[{
        label:'Monthly Generation',
        data:Object.values(monthMap)
      }]
    }
  });

});
</script>

</body>
</html>
